apiVersion: apps/v1
kind: Deployment
metadata: {name: session-service}
spec:
  selector: {matchLabels: {app: session-service}}
  template:
    metadata: {labels: {app: session-service}}
    spec:
      containers:
      - name: session
        image: session-service:latest
        imagePullPolicy: Never
        envFrom: [{secretRef:{name: db-credentials}}]
        env:
        - {name: SPRING_CONFIG_IMPORT, value: "configserver:http://config:8888"}
        ports:
        - {containerPort: 8080}
        - {containerPort: 9090}
        readinessProbe:
          httpGet: {path: /actuator/health, port: 9090}
          initialDelaySeconds: 10
          periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata: {name: session-service}
spec:
  ports: [{port: 8080}]
  selector: {app: session-service}
